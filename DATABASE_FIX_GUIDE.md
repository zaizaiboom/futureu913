# æ•°æ®åº“ä¿®å¤æŒ‡å—

## ğŸš¨ é‡è¦æç¤º

ä»é”™è¯¯æ—¥å¿—ä¸­å¯ä»¥çœ‹åˆ°ä»¥ä¸‹æ•°æ®åº“è¡¨ç¼ºå¤±çš„é—®é¢˜ï¼š
- `user_profiles` - ç”¨æˆ·èµ„æ–™è¡¨
- `user_target_domains` - ç”¨æˆ·ç›®æ ‡é¢†åŸŸè¡¨
- `user_skills` - ç”¨æˆ·æŠ€èƒ½è¡¨
- `user_notification_settings` - ç”¨æˆ·é€šçŸ¥è®¾ç½®è¡¨
- `user_preferences` - ç”¨æˆ·åå¥½è®¾ç½®è¡¨
- `practice_sessions` - ç»ƒä¹ è®°å½•è¡¨
- `learning_stats` - å­¦ä¹ ç»Ÿè®¡è¡¨

## ğŸ“‹ ä¿®å¤æ­¥éª¤

### æ­¥éª¤1ï¼šç™»å½•Supabaseæ§åˆ¶å°

1. æ‰“å¼€ [Supabaseæ§åˆ¶å°](https://supabase.com/dashboard)
2. é€‰æ‹©ä½ çš„é¡¹ç›®
3. ç‚¹å‡»å·¦ä¾§èœå•ä¸­çš„ "SQL Editor"

### æ­¥éª¤2ï¼šæ‰§è¡Œæ•°æ®åº“ä¿®å¤è„šæœ¬

1. åœ¨SQLç¼–è¾‘å™¨ä¸­ï¼Œå¤åˆ¶å¹¶ç²˜è´´ `complete-database-fix.sql` æ–‡ä»¶çš„å…¨éƒ¨å†…å®¹
2. ç‚¹å‡» "Run" æŒ‰é’®æ‰§è¡Œè„šæœ¬
3. ç¡®è®¤æ‰€æœ‰è¯­å¥éƒ½æˆåŠŸæ‰§è¡Œï¼Œæ²¡æœ‰é”™è¯¯

### æ­¥éª¤3ï¼šéªŒè¯è¡¨åˆ›å»º

åœ¨SQLç¼–è¾‘å™¨ä¸­è¿è¡Œä»¥ä¸‹æŸ¥è¯¢æ¥éªŒè¯è¡¨æ˜¯å¦åˆ›å»ºæˆåŠŸï¼š

```sql
SELECT table_name 
FROM information_schema.tables 
WHERE table_schema = 'public' 
AND table_name IN (
    'user_profiles',
    'user_target_domains', 
    'user_skills',
    'user_notification_settings',
    'user_preferences',
    'practice_sessions',
    'learning_stats'
)
ORDER BY table_name;
```

åº”è¯¥è¿”å›7è¡Œç»“æœï¼ŒåŒ…å«æ‰€æœ‰è¡¨åã€‚

### æ­¥éª¤4ï¼šéªŒè¯RLSç­–ç•¥

è¿è¡Œä»¥ä¸‹æŸ¥è¯¢æ¥éªŒè¯RLSç­–ç•¥æ˜¯å¦åˆ›å»ºæˆåŠŸï¼š

```sql
SELECT schemaname, tablename, policyname 
FROM pg_policies 
WHERE schemaname = 'public'
ORDER BY tablename, policyname;
```

### æ­¥éª¤5ï¼šé‡å¯å¼€å‘æœåŠ¡å™¨

åœ¨ç»ˆç«¯ä¸­åœæ­¢å½“å‰çš„å¼€å‘æœåŠ¡å™¨ï¼ˆCtrl+Cï¼‰ï¼Œç„¶åé‡æ–°å¯åŠ¨ï¼š

```bash
npm run dev
```

## âœ… éªŒè¯ä¿®å¤ç»“æœ

ä¿®å¤å®Œæˆåï¼Œä»¥ä¸‹åŠŸèƒ½åº”è¯¥æ­£å¸¸å·¥ä½œï¼š

1. **ç”¨æˆ·èµ„æ–™é¡µé¢** (`/profile`)
   - æ˜¾ç¤ºç”¨æˆ·åŸºæœ¬ä¿¡æ¯
   - ç›®æ ‡é¢†åŸŸå’ŒæŠ€èƒ½æ ‡ç­¾ç®¡ç†
   - ç»ƒä¹ ç»Ÿè®¡æ•°æ®

2. **è®¾ç½®é¡µé¢** (`/settings`)
   - ç”¨æˆ·èµ„æ–™ç¼–è¾‘
   - é€šçŸ¥è®¾ç½®
   - åå¥½è®¾ç½®

3. **ç»ƒä¹ è®°å½•é¡µé¢** (`/practice-history`)
   - æ˜¾ç¤ºå†å²ç»ƒä¹ è®°å½•
   - ç»ƒä¹ ç»Ÿè®¡å›¾è¡¨

4. **å­¦ä¹ æŠ¥å‘Šé¡µé¢** (`/learning-report`)
   - å­¦ä¹ è¿›åº¦ç»Ÿè®¡
   - æˆç»©åˆ†æ

## ğŸ› å¸¸è§é—®é¢˜

### é—®é¢˜1ï¼š"table does not exist" é”™è¯¯

**è§£å†³æ–¹æ¡ˆï¼š**
- ç¡®è®¤å·²å®Œæ•´æ‰§è¡Œ `complete-database-fix.sql` è„šæœ¬
- æ£€æŸ¥Supabaseé¡¹ç›®æ˜¯å¦æ­£ç¡®
- éªŒè¯ç¯å¢ƒå˜é‡é…ç½®

### é—®é¢˜2ï¼š"permission denied" é”™è¯¯

**è§£å†³æ–¹æ¡ˆï¼š**
- ç¡®è®¤RLSç­–ç•¥å·²æ­£ç¡®åˆ›å»º
- æ£€æŸ¥ç”¨æˆ·è®¤è¯çŠ¶æ€
- éªŒè¯ç­–ç•¥ä¸­çš„ `auth.uid()` å‡½æ•°

### é—®é¢˜3ï¼šCookieè§£æé”™è¯¯

**è§£å†³æ–¹æ¡ˆï¼š**
- å·²ä¿®å¤ `lib/supabase/server.ts` ä¸­çš„cookieå¤„ç†
- é‡å¯å¼€å‘æœåŠ¡å™¨
- æ¸…é™¤æµè§ˆå™¨ç¼“å­˜å’Œcookie

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœä¿®å¤åä»æœ‰é—®é¢˜ï¼Œè¯·æä¾›ï¼š
1. å…·ä½“çš„é”™è¯¯æ¶ˆæ¯
2. æµè§ˆå™¨æ§åˆ¶å°æ—¥å¿—
3. Supabase SQLç¼–è¾‘å™¨çš„æ‰§è¡Œç»“æœ
4. å½“å‰è®¿é—®çš„é¡µé¢URL

---

**æœ€åæ›´æ–°ï¼š** 2024å¹´1æœˆ  
**çŠ¶æ€ï¼š** å·²ä¿®å¤æ‰€æœ‰å·²çŸ¥é—®é¢˜ï¼Œç­‰å¾…ç”¨æˆ·æ‰§è¡Œæ•°æ®åº“è„šæœ¬