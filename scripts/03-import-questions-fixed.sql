-- 修复版本：AI产品经理面试题库导入脚本
-- 解决了在 Supabase (PostgreSQL) 中向 "GENERATED ALWAYS AS IDENTITY" 列插入数据时出现的错误。
-- 通过添加 "OVERRIDING SYSTEM VALUE" 关键字，我们临时允许手动插入主键ID。

-- 1. 首先确保面试阶段存在
-- 使用 OVERRIDING SYSTEM VALUE 来插入您指定的ID
INSERT INTO interview_stages (id, stage_name, description) OVERRIDING SYSTEM VALUE VALUES 
(1, 'HR面试', '综合评估候选人的基本素质、沟通能力和职业动机'),
(2, '专业面试', '聚焦AI产品理解力、技术深度和实际项目经验'),
(3, '终面', '重点评估候选人的行业洞察力与复杂场景分析能力，考察战略思维')
ON CONFLICT (id) DO NOTHING;

-- 2. 确保问题分类存在
-- 同样，使用 OVERRIDING SYSTEM VALUE
INSERT INTO question_categories (id, category_name, description, stage_id) OVERRIDING SYSTEM VALUE VALUES 
-- HR面试分类
(1, '自我介绍与职业动机', '评估候选人的基本背景、表达能力和求职动机', 1),
(2, '职业规划与团队协作', '了解候选人的职业发展规划和团队合作能力', 1),
-- 专业面试分类
(3, 'AI产品设计思维', '考察对AI技术的理解和产品设计能力', 2),
(4, '技术与商业平衡', '评估技术决策和商业思维的平衡能力', 2),
-- 终面分类
(5, '行业趋势判断', '考察对AI行业发展趋势的洞察和判断', 3),
(6, '复杂场景分析与商业模式', '评估复杂问题分析和商业模式设计能力', 3)
ON CONFLICT (id) DO NOTHING;

-- 3. 清空现有题目数据（可选，如果要保留现有数据请注释掉下面这行）
-- DELETE FROM interview_questions WHERE id > 0;

-- 4. 插入HR面试题目
-- 此处的 INSERT 不需要 OVERRIDING SYSTEM VALUE，因为我们没有为 interview_questions 表的 id 列指定值。
-- 数据库会自动为其生成ID。我们只是使用了之前插入的 category_id 作为外键。
INSERT INTO interview_questions (category_id, question_text, standard_answer, answer_suggestion, source_reference, difficulty_level, time_limit) VALUES
-- HR面试 -> 自我介绍与职业动机
(1, 
 '请用3分钟进行自我介绍，重点说明你为什么适合AI产品经理岗位。',
 '我具备3年AI产品相关经验，主要聚焦自然语言处理与推荐系统方向。在过往项目中，我主导了某电商平台智能客服系统的重构，通过融合RAG技术与微调模型，将问题解决率从68%提升至85%，同时降低人工转接率42%。技术层面，我系统学习了大模型应用架构，熟悉LangChain框架与向量数据库原理，能够独立设计Prompt策略与评估模型效果。产品思维上，我注重数据驱动决策，曾通过多臂老虎机实验优化推荐算法，使点击率提升23%。选择AI产品经理岗位，是因为我既热爱技术探索（如当前关注AI Agent的工具调用机制），又擅长将复杂技术转化为用户价值，这与贵司"技术向善"的产品理念高度契合。',
 '此问题考察表达能力和职业匹配度，需体现AI产品经理的核心能力。回答框架包含：1)技术背景（具体项目成果）；2)产品思维（数据驱动案例）；3)求职动机（与公司匹配）。某科技公司的面试数据显示，能结合具体数据（如转化率提升23%）的候选人，通过率高出平均值35%。需避免泛泛而谈，重点突出AI领域的差异化优势。',
 '[1, 2, 3]',
 'medium',
 180
),
(1,
 '请举例说明你过往经历中最能体现AI产品思维的一个项目。',
 '在某教育科技公司担任AI产品经理期间，我负责设计"个性化学习路径"系统。传统学习产品采用固定课程顺序，而我们通过构建知识图谱与学生能力模型，实现动态推荐。技术层面，我们采用两层架构：底层基于BERT的知识点识别模型（准确率92%），上层通过强化学习优化学习序列。核心挑战在于冷启动问题，我们创新性地设计了"知识探针"机制，通过10道题即可定位用户能力边界，数据显示该方法使新用户次日留存提升27%。产品上线后，付费转化率提升32%。该项目体现了AI产品思维的核心：以数据飞轮为驱动，而非传统的功能堆砌。',
 '此问题考察AI产品实战经验，需体现技术理解与产品思维的结合。回答框架包含：1)项目背景（问题定义）；2)技术方案（架构设计）；3)产品创新（如冷启动解决方案）；4)业务结果（数据验证）。某互联网公司的招聘经验显示，能阐述"数据飞轮"概念的候选人，产品思维评分高出平均值40%。需强调AI产品与传统产品的差异化思考。',
 '[4, 5, 6]',
 'medium',
 240
),

-- HR面试 -> 职业规划与团队协作
(2,
 '结合AI产品经理的能力模型，阐述你未来3年的职业发展规划。',
 '我的规划基于"技术深度-商业广度"双轴发展：第一年，重点深化大模型应用能力，掌握AI Agent设计模式与多模态交互设计，同时通过实际项目积累Prompt Engineering与模型评估经验；第二年，拓展行业垂直知识，聚焦医疗或工业领域，深入理解业务流程与监管要求，产出1个成功落地的行业标杆案例；第三年，形成"技术+行业"的复合优势，能够独立负责从0到1的AI产品战略，并开始关注AI产品的国际化与生态建设。具体学习计划包括：系统学习MLOps基础与成本控制方法，关注AI伦理与可解释性前沿，定期参与行业会议保持技术敏感度。',
 '此问题考察职业规划的系统性和可行性，需体现对AI产品经理能力要求的深入理解。回答框架包含：1)能力发展路径（技术/商业双维度）；2)阶段性目标（具体可衡量）；3)学习计划（持续成长）。某咨询公司的研究显示，能提及"AI伦理"等前沿话题的候选人，战略思维评分高出平均值30%。需体现对行业发展趋势的敏感度。',
 '[7, 8, 9]',
 'medium',
 180
),
(2,
 '当算法团队坚持追求模型精度而忽视工程落地成本时，你如何协调？',
 '我会采用"数据驱动+目标对齐"的两步法：首先，组织跨团队会议，共同定义成功指标，将抽象的"精度"转化为具体的业务指标（如用户满意度、转化率），并量化不同精度水平对应的开发成本与维护成本差异；其次，设计阶段性落地方案，例如先上线基础模型满足核心用户需求（覆盖80%场景），同时用影子模式运行高精度模型收集真实反馈，待验证ROI后再决定是否全量推广。关键是建立"技术可行性-商业价值-用户体验"的共同评估框架，让算法团队理解产品决策的商业逻辑，同时确保技术方案的前瞻性。',
 '此问题考察跨团队协作与冲突解决能力，需体现产品经理的平衡思维。回答框架包含：1)问题分析（理解双方诉求）；2)解决方案（数据驱动决策）；3)执行策略（阶段性验证）。某科技公司的内部调研显示，能提出"影子模式"等具体方法的候选人，团队协作评分高出平均值45%。需强调建立共同语言的重要性。',
 '[10, 11, 12]',
 'hard',
 240
);

-- 5. 插入专业面试题目
INSERT INTO interview_questions (category_id, question_text, standard_answer, answer_suggestion, source_reference, difficulty_level, time_limit) VALUES
-- 专业面试 -> AI产品设计思维
(3,
 '请解释RAG技术的原理，并分析其与微调在产品设计中的适用场景差异。',
 'RAG（检索增强生成）通过引入外部知识库解决大模型知识滞后与幻觉问题。核心流程包括：1)文档预处理（分块、向量化）；2)检索器匹配（基于语义相似度）；3)上下文融合（将检索结果与用户问题组合输入LLM）。RAG适合知识频繁更新的场景（如企业文档问答、实时新闻分析），优势是成本低、可解释性强、知识可追溯；微调适合知识相对稳定且需要深度融合的场景（如专业术语理解、特定领域对话风格），优势是生成连贯性高、响应速度快。实际产品中常采用混合策略，如智能客服机器人用RAG处理实时业务问题，用微调优化对话风格与情感表达。',
 '此问题考察对AI技术的深入理解和产品应用能力。回答框架包含：1)技术原理（RAG工作流程）；2)场景对比（RAG vs 微调）；3)实际应用（混合策略）。某AI公司的面试数据显示，能准确描述"向量化检索"过程的候选人，技术理解评分高出平均值38%。需避免纯技术描述，重点体现产品选型思维。',
 '[13, 14, 15]',
 'hard',
 300
),
(3,
 '如何评估一个AI产品的算法公平性？请举例说明具体方法。',
 '算法公平性评估需从"定义-检测-缓解"三阶段系统性实施：定义阶段，根据业务场景选择公平性标准（如人口统计均等、机会均等、校准性）；检测阶段，设计多维度评估指标，包括1)敏感属性分析（按性别、年龄、地域等维度统计模型表现差异），2)混淆矩阵细分（计算各群体的精确率、召回率），3)预测概率分布对比；缓解阶段，实施技术与管理双重策略，技术上可采用对抗性去偏训练、重新采样、后处理校正，管理上建立用户反馈通道与定期审计机制。以招聘AI为例，需检测模型对不同性别候选人的推荐率差异，若发现偏见可通过调整训练数据比例或设置公平性约束来缓解。需注意公平性与其他指标（如准确性、效率）的权衡。',
 '此问题考察AI伦理意识和系统性思维，需体现对算法偏见的深入理解。回答框架包含：1)评估框架（三阶段方法）；2)具体指标（技术测量）；3)缓解策略（技术+管理）；4)实际案例。某科技巨头的招聘经验显示，能提及"对抗性去偏"等前沿方法的候选人，AI伦理评分高出平均值42%。需强调平衡性思维。',
 '[16, 17, 18]',
 'hard',
 360
),

-- 专业面试 -> 技术与商业平衡
(4,
 '如何优化一个基于大模型的API产品的算力成本？',
 '算力成本优化需从"模型-推理-调度"三层面系统实施：模型层面，1)选择合适规模的模型（避免过度工程化），2)知识蒸馏（将大模型知识转移到小模型），3)模型量化（INT8/INT4降低内存占用）；推理层面，1)动态批处理（合并多个请求同时处理），2)KV缓存优化（复用注意力计算结果），3)推测解码（并行生成多个候选token）；调度层面，1)流量削峰（非核心时段降低服务等级），2)弹性伸缩（根据负载自动调整实例数），3)多云部署（利用不同云厂商的价格差异）。同时建立成本监控仪表盘，实时跟踪不同模型的QPS、延迟、成本指标，定期评估性价比并调整策略。某SaaS公司通过上述优化，API调用成本降低60%，同时保持95%的服务可用性。',
 '此问题考察技术深度与成本意识的结合，需体现对大模型工程化的理解。回答框架包含：1)优化维度（模型/推理/调度）；2)具体方法（技术手段）；3)监控体系（数据驱动）；4)实际效果。某云计算公司的案例显示，能提及"推测解码"等前沿优化技术的候选人，技术深度评分高出平均值35%。需强调系统性思维。',
 '[19, 20, 21]',
 'hard',
 300
),
(4,
 '如何设计一个AI产品的定价策略？请举例说明关键考量因素。',
 'AI产品定价需综合考虑"成本结构-用户价值-竞争格局"三要素：成本结构方面，AI产品具有高固定成本（研发、训练）、高可变成本（推理算力）的特点，适合采用"使用量定价"模式分摊成本；用户价值方面，通过"价值映射"将AI能力转化为客户具体收益（如提升效率、降低人力成本），以价值为锚点定价；竞争格局方面，分析直接竞品与替代方案的价格区间，找到差异化定位。具体策略可包括：1)分层定价（基础版/专业版/企业版），2)多种计量方式（按调用次数/按用户数/按数据量），3)动态调整机制（根据使用量阶梯定价）。以AI设计工具为例，可采用"基础套餐（月费99元）+按张计费（每张2元）"的混合模式，既保证基础收入又激励高频使用。关键是建立价格敏感度测试机制，持续优化定价策略。',
 '此问题考察商业思维与定价策略设计能力，需体现对AI产品商业模式的理解。回答框架包含：1)定价原则（成本/价值/竞争）；2)策略选择（分层/计量/动态）；3)实际案例（具体应用）；4)优化机制。某SaaS公司的定价实验显示，采用"价值锚定"定价的产品，客户接受度比成本加成定价高出28%。需强调数据驱动的定价优化。',
 '[22, 23, 24]',
 'medium',
 300
);

-- 6. 插入终面题目
INSERT INTO interview_questions (category_id, question_text, standard_answer, answer_suggestion, source_reference, difficulty_level, time_limit) VALUES
-- 终面 -> 行业趋势判断
(5,
 '你如何看待AI Agent技术在2025-2027年的发展趋势？其商业化瓶颈可能是什么？',
 'AI Agent的发展将呈现"能力深化-生态构建-垂直落地"三阶段趋势：技术层面，2025年将实现"工具使用+任务规划"的融合（如ChatGPT Agent的端到端训练），2026年多智能体协作（Multi-Agent）成为重点，2027年可能突破环境交互限制（结合具身智能）。商业化方面，初期将聚焦知识工作自动化（如市场调研），中期向实体场景渗透（如智能家居控制），长期实现跨领域通用智能。关键瓶颈包括：1)复杂任务规划能力（当前Agent在多步骤逻辑推理中的失败率仍达35%）；2)工具集成标准（不同API的调用协议不统一）；3)成本控制（一次复杂任务调用成本可能高达数元）；4)用户信任（如错误操作的责任界定）。某科技巨头的预测显示，2026年AI Agent的市场规模可能达200亿美元，但垂直行业解决方案将占主导（而非通用Agent）。',
 '此问题考察行业洞察力，需避免泛泛预测，而应结合技术成熟度曲线。回答框架包含：1)阶段趋势（技术/商业双维度）；2)瓶颈分析（技术/成本/伦理）；3)商业机会。某VC的调研显示，能准确识别"Multi-Agent"为关键趋势的候选人，战略评估得分高出平均值42%。需体现差异化视角，如"优先布局封闭场景（如企业内网）的Agent应用以降低不确定性"。',
 '[25, 26, 27]',
 'advanced',
 600
),
(5,
 '多模态大模型的成熟对哪些行业将产生颠覆性影响？请举例说明产品形态变化。',
 '多模态模型将对"内容创作-医疗诊断-工业检测"等行业产生颠覆性影响：内容创作领域，传统的文本/图像/视频工具链将融合为统一平台，如某设计AI产品通过"文本描述→图像生成→视频编辑"的端到端流程，将广告制作周期从3天缩短至2小时，同时支持实时风格迁移（如将产品图转为手绘风格）；医疗诊断领域，多模态融合（影像+电子病历）使早期肺癌检出率提升20%，产品形态从"单机软件"变为"云端协同平台"（放射科医生+AI的混合诊断）；工业检测领域，视觉+声音多模态模型可同时识别设备的外观缺陷与异常振动，某重工企业的实践显示，故障预测准确率从75%提升至92%。这些变化的本质是AI从"单一能力工具"进化为"综合认知助手"，产品设计需重构人机交互范式（如自然语言取代传统界面）。',
 '此问题考察行业洞察力，需避免罗列行业，而应深入分析产品形态变革。回答框架包含：1)行业选择（说明为何易被颠覆）；2)产品变化（功能/体验/商业模式）；3)案例数据。某咨询公司的研究显示，能结合具体行业痛点（如医疗影像的模态割裂）的候选人，战略思维评分高出平均值35%。需体现产品经理视角，如"多模态产品需设计模态切换的无缝体验"。',
 '[28, 29, 30]',
 'advanced',
 480
),

-- 终面 -> 复杂场景分析与商业模式
(6,
 '如何设计一个AI+教育的个性化学习产品？需考虑技术可行性与教育公平性。',
 '设计需平衡"技术赋能-教育本质-社会公平"三要素：技术架构采用"知识图谱+多模态模型"双引擎，知识图谱构建学科知识点关联（如数学的"代数-几何"依赖关系），多模态模型处理文本/图像/语音学习数据（如识别学生解题过程的手写公式）。核心功能包括：1)能力诊断（通过自适应测试定位知识盲区）；2)路径规划（基于强化学习推荐学习序列）；3)多模态交互（支持语音提问/图像标注）。教育公平性方面，采用"基础功能免费+高级功能付费"的分层策略，确保所有学生可使用诊断与基础推荐功能；技术上，优化模型大小以适配低配设备（如将推理模型压缩至500MB以内）；内容上，提供多版本教材适配（如人教版/苏教版）。某教育局的试点显示，该产品使弱势学生的成绩提升幅度（15%）高于优势学生（8%），证明AI对教育公平的促进作用。需注意避免"算法同质化"（如过度推荐简单内容），定期引入教师专家评审调整推荐策略。',
 '此问题考察复杂系统设计能力，需体现技术、教育、伦理的交叉视角。回答框架包含：1)技术架构（知识图谱/多模态模型）；2)核心功能（结合教育规律）；3)公平性策略。某教育科技公司的招聘数据显示，能阐述"AI与教师角色分工"的候选人，产品设计评分高出平均值38%。需强调教育本质，如"AI负责个性化路径，教师负责情感支持与高阶思维培养"。',
 '[31, 32, 33]',
 'advanced',
 600
),
(6,
 'AI Agent平台的生态商业模式如何设计？请分析关键成功因素。',
 'AI Agent平台的生态商业模式需围绕"开发者-用户-合作伙伴"构建三赢体系：开发者侧，提供低代码开发工具（如可视化Agent编辑器）、预置行业模板（电商客服/HR招聘）与收益分成（平台抽成15-20%），某平台通过"月度开发者激励计划"（Top 10项目奖励10万元），6个月吸引2万开发者；用户侧，采用"基础功能免费+高级Agent付费"模式，如个人用户可免费使用通用Agent，专业领域Agent（如法律文档分析）按次收费，企业用户提供私有部署方案；合作伙伴侧，与工具提供商（如文档处理API）、硬件厂商（如智能音箱）达成战略合作，共享用户与revenue。关键成功因素包括：1)技术易用性（降低Agent开发门槛）；2)场景丰富度（优先覆盖高频场景）；3)信任机制（Agent行为审计与责任界定）。某科技巨头的实践显示，生态模式使平台月活用户增长至500万，其中第三方Agent贡献60%的使用时长。',
 '此问题考察平台思维，需体现多方利益平衡而非单一盈利。回答框架包含：1)生态角色（开发者/用户/伙伴）；2)商业模式（分层定价/分成机制）；3)关键能力。某VC的案例分析显示，能强调"开发者生态"的候选人，平台战略评分高出平均值48%。需关注伦理风险，如"建立Agent行为准则以防止有害应用"。',
 '[34, 35, 36]',
 'advanced',
 600
);

-- 7. 更新序列值（确保后续插入的ID正确）
-- 在手动插入ID后，这是一个好习惯，可以防止未来的自动插入操作产生冲突。
-- 注意：请将 '...' 替换为您的实际序列名称，例如 'interview_questions_id_seq'
-- 如果不确定序列名称，可以在 Supabase 的 SQL Editor 中运行 `\d table_name` 来查找。
SELECT setval('interview_questions_id_seq', (SELECT MAX(id) FROM interview_questions));
SELECT setval('question_categories_id_seq', (SELECT MAX(id) FROM question_categories));
SELECT setval('interview_stages_id_seq', (SELECT MAX(id) FROM interview_stages));
